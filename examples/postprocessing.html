<!DOCTYPE html>
<html>
	<head>
		<title>CrimildJS Example: Post-Processing</title>
	    <script type="text/javascript" src="../lib/jquery-1.9.0.js"></script>
	    <script type="text/javascript" src="../lib/jquery-ui-1.10.0.custom.min.js"></script>
		<script data-main="../src/crimild" src="../lib/require.js"></script>
		<link rel="stylesheet" type="text/css" href="../css/smoothness/jquery-ui-1.10.0.custom.min.css">
		<link rel="stylesheet" type="text/css" href="../css/example.css" />
		<script type="text/javascript">
			requirejs([
					"crimild", 
					"image!./assets/earth.jpg",
					"text!../shaders/old_film.vert", "text!../shaders/old_film.frag",
				], function(
					crimild, 
					color_map,
					old_film_vs, old_film_fs
				) {

				var canvas = $("#canvas").get(0);
				canvas.width = window.innerWidth;
				canvas.height = window.innerHeight;

				crimild.run({
					scene: {
						_prototype: crimild.groupNode,
						nodes: [
							{
								_prototype: crimild.geometryNode,
								primitives: [
									{
										_prototype: crimild.spherePrimitive,
									}
								],
								components: [
									{
										_prototype: crimild.effectComponent,
										effects: [
											{
												_prototype: crimild.effect,
												textures: [
													{
														_prototype: crimild.texture,
														image: {
															_prototype: crimild.image,
															data: color_map,
														},
														flipVertical: true
													},
												],
											}
										]
									},
									{
										_prototype: crimild.trackpadComponent,
									},
								],
							},
							{
								_prototype: crimild.cameraNode,
								aspectRatio: (window.innerWidth / window.innerHeight),
								local: {
									translate: [0, 0, 3]
								},
								components: [
									{
										_prototype: crimild.effectComponent,
										effects: [
											{
												_prototype: crimild.effect,
												shaderProgram: {
													vertexShader: old_film_vs,
													fragmentShader: old_film_fs,
												},
												uniforms: [
													{ name: "uSepiaCoeff", data: 0.5, },
													{ name: "uNoiseCoeff", data: 0.25, },
													{ name: "uScratchCoeff", data: 1.0, },
													{ name: "uInnerVignetting", data: 0.0, },
													{ name: "uOuterVignetting", data: 1.5, },
													{ name: "uRandomCoeff", data: 0.0, },
													{ name: "uTime", data: 0.0 },
												],
												update: function(time) {
													this.getUniform("uSepiaCoeff").data = $("#sepia").val();
													this.getUniform("uNoiseCoeff").data = $("#noise").val();
													this.getUniform("uScratchCoeff").data = $("#scratching").val();
													this.getUniform("uInnerVignetting").data = $("#innerVignetting").val();
													this.getUniform("uOuterVignetting").data = $("#outerVignetting").val();
													this.getUniform("uRandomCoeff").data = Math.random() * 1000.0;
													this.getUniform("uTime").data = time.deltaTime;
												}
											}
										]
									}
								]
							}
						]
					},
					renderer: {
						canvas: canvas,
					}
				});
			});

			function createSlider(id, min, max, value, normalize, orientation) {
    			$("#slider-" + id).slider({
    				orientation: orientation || "horizontal",
      				range: "max",
      				min: min,
      				max: max,
      				value: value,
      				slide: function(event, ui) {
        				$("#" + id).val(ui.value / (normalize ? max : 1.0));
      				}
    			});
    			$("#" + id).val($("#slider-" + id).slider("value") / (normalize ? max : 1.0)).hide();
			}

			$(function() {
				createSlider("sepia", 0, 100, 50, true);
				createSlider("noise", 0, 200, 50, true);
				createSlider("scratching", 0, 300, 100);
				createSlider("innerVignetting", 0, 200, 50, true);
				createSlider("outerVignetting", 100, 200, 200, true);
  			});
		</script>
	</head>
	<body>
        <canvas id="canvas">
            Your browser does not support WebGL
        </canvas>
		<div>
	        <div class="hud">
	            <p><a href="javascript:window.parent.location = '../index.html';">crimildjs</a> post-processing example</p>
	            <div class="options">
	            	<div class="option">
	            		<input type="text" id="sepia" />
	            		<div id="slider-sepia"></div>
	            	</div>
	            	<div class="option">
	            		<input type="text" id="noise" />
	            		<div id="slider-noise"></div>
	            	</div>
	            	<div class="option">
	            		<input type="text" id="scratching" />
	            		<div id="slider-scratching"></div>
	            	</div>
	            	<div class="option">
	            		<input type="text" id="innerVignetting" />
	            		<div id="slider-innerVignetting"></div>
	            	</div>
	            	<div class="option">
	            		<input type="text" id="outerVignetting" />
	            		<div id="slider-outerVignetting"></div>
	            	</div>
	            </div>
	        </div>
		</div>
	</body>
</html>

