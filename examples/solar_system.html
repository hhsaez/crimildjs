<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" href="../stylesheets/stylesheet.css" media="screen"/>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="../javascripts/script.js"></script>
    <title>Crimild JS Example</title>
    <meta name="description" content="WebGL based 3D game framework">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script data-main="../src/crimild" src="../lib/require.js"></script>
    <script type="text/javascript">
        function initCrimild(canvasId) {
            require(["crimild"], function(crimild) {
                var assetManager = crimild.utils.assetManager();
                assetManager.queueImage("../assets/sun.gif");
                assetManager.queueImage("../assets/moon.gif");
                assetManager.queueImage("../assets/earth.jpg");
                assetManager.queueImage("../assets/mars.jpg");
                assetManager.loadAll(function() {
                    var orbitingComponent = function(spec) {
                        spec = spec || {};
                        var that = crimild.core.nodeComponent({name: "update"});
                        var x0 = spec.x0 || 0;
                        var y0 = spec.y0 || 0;
                        var x = 0;
                        var y = 0;
                        var a = spec.a || 20;
                        var b = spec.b || 20;
                        var t = 0;
                        var speed = spec.speed || 0.01;
                        var gamma = spec.gamma || 0;

                        that.update = function() {
                            x = x0 + a * Math.cos(t) * Math.cos(gamma) - b * Math.sin(t) * Math.sin(gamma);
                            y = y0 + a * Math.cos(t) * Math.sin(gamma) + b * Math.sin(t) * Math.cos(gamma);

                            t = t + speed;

                            that.node.local.translate = [x, y, 0];
                        };

                        return that;
                    };

                    var scene = crimild.core.groupNode({
                        name: "scene",
                        nodes: [
                            crimild.core.node({
                                name: "a light",
                                components: [
                                    crimild.rendering.lightingComponent({
                                        lights: [
                                            crimild.rendering.light({
                                                color: [1, 1, 1],
                                            })
                                        ]
                                    })
                                ],
                                local: crimild.math.transformation({
                                    translate: [0.0, 0.0, 40.0]
                                })
                            }),
                            crimild.core.groupNode({
                                name: "Sun",
                                local: crimild.math.transformation({
                                    rotate: quat4.fromAngleAxis(-0.45 * Math.PI, [1, 0, 0])
                                }),
                                nodes: [
                                    crimild.core.geometryNode({
                                        primitives: [
                                            crimild.primitives.spherePrimitive({
                                                vertexFormat: crimild.core.vertexFormat({positions: 3, normals: 3, textureCoords: 2}),
                                                radius: 25
                                            })
                                        ],
                                        components: [
                                            crimild.rendering.renderComponent({
                                                effects: [
                                                    crimild.rendering.effect({
                                                        ambient: [1, 1, 1],
                                                        diffuse: [1, 1, 1],
                                                        textures: [
                                                            crimild.rendering.texture({
                                                                image: assetManager.getImage("../assets/sun.gif")
                                                            })
                                                        ]
                                                    })
                                                ]
                                            })
                                        ],
                                    }),
                                    crimild.core.groupNode({
                                        nodes: [
                                            crimild.core.groupNode({
                                                name: "Mercury",
                                                nodes: [
                                                    crimild.core.geometryNode({
                                                        primitives: [
                                                            crimild.primitives.spherePrimitive({
                                                                vertexFormat: crimild.core.vertexFormat(),
                                                                radius: 1
                                                            })
                                                        ],
                                                        components: [
                                                            crimild.rendering.renderComponent({
                                                                effects: [
                                                                    crimild.rendering.effect({
                                                                        diffuse: [0.5, 0.5, 0.75],
                                                                    })
                                                                ]
                                                            })
                                                        ],
                                                    })
                                                ],
                                                components: [
                                                    orbitingComponent({a: 40, b: 40, speed: 0.01})
                                                ]
                                            }),
                                            crimild.core.groupNode({
                                                name: "Venus",
                                                nodes: [
                                                    crimild.core.geometryNode({
                                                        primitives: [
                                                            crimild.primitives.spherePrimitive({
                                                                vertexFormat: crimild.core.vertexFormat(),
                                                                radius: 1.5
                                                            })
                                                        ],
                                                        components: [
                                                            crimild.rendering.renderComponent({
                                                                effects: [
                                                                    crimild.rendering.effect({
                                                                        diffuse: [1, 0.5, 0.5],
                                                                    })
                                                                ]
                                                            })
                                                        ],
                                                    })
                                                ],
                                                components: [
                                                    orbitingComponent({a: 60, b: 60, speed: 0.005})
                                                ]
                                            }),
                                            crimild.core.groupNode({
                                                name: "Earth",
                                                nodes: [
                                                    crimild.core.groupNode({
                                                        nodes: [
                                                            crimild.core.groupNode({
                                                                name: "Moon",
                                                                nodes: [
                                                                    crimild.core.geometryNode({
                                                                        primitives: [
                                                                            crimild.primitives.spherePrimitive({
                                                                                vertexFormat: crimild.core.vertexFormat({positions: 3, normals: 3, textureCoords: 2}),
                                                                            })
                                                                        ],
                                                                        components: [
                                                                            crimild.rendering.renderComponent({
                                                                                effects: [
                                                                                    crimild.rendering.effect({
                                                                                        textures: [
                                                                                            crimild.rendering.texture({
                                                                                                image: assetManager.getImage("../assets/moon.gif")
                                                                                            })
                                                                                        ]
                                                                                    })
                                                                                ]
                                                                            })
                                                                        ],
                                                                    })
                                                                ],
                                                                components: [
                                                                    orbitingComponent({a: 7, b: 7, speed: 0.07})
                                                                ],
                                                            })
                                                        ]
                                                    }),
                                                    crimild.core.geometryNode({
                                                        primitives: [
                                                            crimild.primitives.spherePrimitive({
                                                                vertexFormat: crimild.core.vertexFormat({positions: 3, normals: 3, textureCoords: 2}),
                                                                radius: 4
                                                            })
                                                        ],
                                                        local: crimild.math.transformation({
                                                            rotate: quat4.fromAngleAxis(0.5 * Math.PI, [1, 0, 0])
                                                        }),
                                                        components: [
                                                            crimild.rendering.renderComponent({
                                                                effects: [
                                                                    crimild.rendering.effect({
                                                                        textures: [
                                                                            crimild.rendering.texture({
                                                                                image: assetManager.getImage("../assets/earth.jpg")
                                                                            })
                                                                        ]
                                                                    })
                                                                ]
                                                            })
                                                        ],
                                                    })
                                                ],
                                                components: [
                                                    orbitingComponent({a: 80, b: 80, speed: 0.0025})
                                                ]
                                            }),
                                            crimild.core.groupNode({
                                                name: "Mars",
                                                nodes: [
                                                    crimild.core.geometryNode({
                                                        primitives: [
                                                            crimild.primitives.spherePrimitive({
                                                                vertexFormat: crimild.core.vertexFormat({positions: 3, normals: 3, textureCoords: 2}),
                                                                radius: 2
                                                            })
                                                        ],
                                                        components: [
                                                            crimild.rendering.renderComponent({
                                                                effects: [
                                                                    crimild.rendering.effect({
                                                                        textures: [
                                                                            crimild.rendering.texture({
                                                                                image: assetManager.getImage("../assets/mars.jpg")
                                                                            })
                                                                        ]
                                                                    })
                                                                ]
                                                            })
                                                        ],
                                                    }),
                                                    crimild.core.groupNode({
                                                        nodes: [
                                                            crimild.core.groupNode({
                                                                name: "Deimos",
                                                                nodes: [
                                                                    crimild.core.groupNode({

                                                                    }),
                                                                    crimild.core.geometryNode({
                                                                        primitives: [
                                                                            crimild.primitives.spherePrimitive({
                                                                                vertexFormat: crimild.core.vertexFormat(),
                                                                                radius: 0.5
                                                                            })
                                                                        ],
                                                                    })
                                                                ],
                                                                components: [
                                                                    orbitingComponent({a: 3, b: 3, speed: 0.15})
                                                                ],
                                                            }),
                                                            crimild.core.groupNode({
                                                                name: "Phobos",
                                                                nodes: [
                                                                    crimild.core.groupNode({

                                                                    }),
                                                                    crimild.core.geometryNode({
                                                                        primitives: [
                                                                            crimild.primitives.spherePrimitive({
                                                                                vertexFormat: crimild.core.vertexFormat(),
                                                                                radius: 0.5
                                                                            })
                                                                        ],
                                                                    })
                                                                ],
                                                                components: [
                                                                    orbitingComponent({a: 5, b: 5, speed: 0.1})
                                                                ],
                                                            })
                                                        ]
                                                    }),
                                                ],
                                                components: [
                                                    orbitingComponent({a: 100, b: 100, speed: 0.0015})
                                                ]
                                            }),
                                        ]
                                    }),
                                ],
                            })
                        ],
                        local: crimild.math.transformation({
                            translate: [0, 0, -150],
                        }),
                        components: [
                            (function() {
                                var that = crimild.core.nodeComponent({name: "update"});

                                that.update = function() {
                                    that.node.perform(crimild.core.worldStateUpdate());
                                };

                                return that;
                            })()
                        ]
                    });

                    crimild.simulation.run({
                        canvas: document.getElementById(canvasId), 
                        scenes: [scene]
                    }).getRenderer().setClearColor([0, 0, 0.1, 1]);
                })
            });
        }
    </script>
</head>

<body onload="initCrimild('webGLCanvas');">
  <div class="wrapper">
    <header>
      <h1 class="title">Crimild JS</h1>
    </header>
    <div id="container">
      <p class="tagline">WebGL based 3D framework</p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/hhsaez/crimildjs/tarball/master" class="download-button tar"><span>Download</span></a>
          <a href="https://github.com/hhsaez/crimildjs/zipball/master" class="download-button zip"><span>Download</span></a>
          <a href="https://github.com/hhsaez/crimildjs" class="code">View Crimildjs on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
            <div>
                <div style="float: right;"><a href="camera.html">Next&nbsp;&gt;</a></div>
                <div style="clear: all;"><a href="picking.html">&lt;&nbsp;Previous</a></div>
            </div>
            <h3>Crimild JS Example: Solar System</h3>

            <p>This example employs a complex node hierarchy and transforms to recreate the Solar System</p>

            <canvas id="webGLCanvas" style="border: solid 1px; margin-left: -5px;" width="640" height="480">
                Your browser does not support WebGL
            </canvas>

        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/hhsaez" class="avatar"><img src="https://secure.gravatar.com/avatar/2e9781f946d0b1182d623cb50a534c23?s=30&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png" width="48" height="48"/></a> <a href="https://github.com/hhsaez">hhsaez</a> maintains <a href="https://github.com/hhsaez/crimildjs">Crimildjs</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br/>theme by <a href="http://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/hhsaez/crimildjs/tarball/master" class="tar">tar</a><a href="https://github.com/hhsaez/crimildjs/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

  
</body>
</html>
